# Thrift: スケーラブルで言語横断的なサービスの実装

Mark Slee,
Aditya Agarwal,
Marc Kwiatkowski

Facebook, 156 University Ave, Palo Alto, CA

{mcslee,aditya,marc}@facebook.com

## 要約

Thrift は、効果的でスケーラブルなバックエンドサービスの開発を支援するため、Facebook で開発された、ソフトウェア群、及び、コードジェネレータツール群です。
各言語の共通ライブラリに手を入れる事が必要になりがちな、言語間コミュニケーションを、各言語の一部分を抽象化することによって、効率的かつ信頼性高く可能とする事がその主目的です。
より具体的には、Thrift はデータ型と、サービスのインターフェースを、特定の言語に依存しない形式で記述する事によって、RPC のクライアントとサーバーの実装に必要なすべてのコードを生成する事が出来ます。

当論文では、Thrift の背景にあるモチベーションや、設計上の選択について述べると共に、実装上の興味深い詳細部分について記述します。
当論文は、研究としてというよりは、私たちがやった事、及び、なぜそうのようにしたかの解説として捉えられることを意図したものです。


## 1. 導入

Facebook のトラフィックおよびネットワークの構造がスケールアップして行くに従って、サイト運用上の様々なリソースの需要 (例えば、検索、広告配信、イベントロギングなど) からくる技術的な要求は、従来の LAMP スタックの範疇を遥かに超え始めていた。これらのサービスを実装して行く過程において、パフォーマンスや生産性、既存ライブラリの有無など、いろいろな観点で最適化を図る過程で、様々な言語が選択されていた。Facebook の開発文化は、ひとつの開発言語のもとにすべてを標準化していくよりは、目的に応じて最適なツールと実装を選択するという方向に向かっていた。

この様な方向性の選択のもとにおいて、私たちは次のような、技術的挑戦に直面していた。すなわち、透過的に、ハイパフォーマンスな多言語間ブリッジを構築することが必要だった。その当時利用可能だったソリューションはどれも、あまりにも制約が強すぎるか、十分な表現力を持たないか、パフォーマンスが足りないものしか見つからなかった。



(WIP)

## 2. Types - 型システム

Thrift の型システムの目的は、プログラム言語が何かによらず、その言語のネイティブな型でプログラムを書けるようにするということです。Thrift の型システムは、特殊な動的型や、ラッパーオブジェクト等は一切導入しません。また、オブジェクトのシリアライズや転送に関するコードを書くことも要求しません。

(WIP)

### 2.1 基本型

### 2.2 構造体

### 2.3 コンテナ

### 2.4 例外

### 2.5 サービス

## 3. Transport - 転送

(WIP)

### 3.1 インターフェース

### 3.2 実装

## 4. Protocol

(WIP)

### 4.1 インターフェース

### 4.2 構造

### 4.3 実装

## 5. Versioning

(WIP)

## 6. RPC の実装

(WIP)

## 7. 実装詳細

(WIP)

## 8. Facebook での事例

(WIP)

## 9. まとめ

(WIP)

## 謝辞

Thrift に対するフィードバックを頂いた事について、Martin Smith, Karl Voskuil, Yishan Wong に感謝します。

Thrift は Adam D’Angelo の開発した Pillar というシステムの後継プロジェクトです。Pillar は最初 Caltech で開発され、後に Facebook で開発が継続されました。Thrift は Adam の見識が無ければ存在しなかったでしょう。

## 参考文献

- [1] Kempf, William, “Boost.Threads”, http://www.boost.org/doc/html/threads.html
- [2] Henkel, Philipp, “threadpool”, http://threadpool.sourceforge.net